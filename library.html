<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="no-referrer-when-downgrade">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: 'unsafe-inline' 'unsafe-eval';">
  <title>Nursing Digital Library | Olivarez College</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    /* Same CSS as before */
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo-group">
        <a href="index.html" class="back-home">
          <i class="fas fa-chevron-left"></i>
          <img src="https://olivarezcollegetagaytay.edu.ph/img/olivarez-college-tagaytay-logo.png" alt="College Logo" class="logo">
        </a>
        <h1>Nursing Resource Hub</h1>
      </div>
    </div>
  </header>

  <main>
    <!-- Admin Upload Panel -->
    <section class="admin-panel">
      <h2>Upload New Book</h2>
      <form id="book-form">
        <input type="text" id="book-title" placeholder="Book Title" required>
        <input type="text" id="book-year" placeholder="Year Level (e.g., 1st, 2nd, 3rd, 4th)" required>
        <input type="text" id="book-subject" placeholder="Subject" required>
        <input type="url" id="book-image-url" placeholder="Image URL" required>
        <input type="url" id="book-pdf-url" placeholder="PDF URL" required>
        <button type="submit">Add Book</button>
      </form>
    </section>

    <!-- Digital Library -->
    <section class="library-container">
      <h2>
        <i class="fas fa-book-open" style="color: var(--primary); margin-right: 0.5rem;"></i>
        Digital Library
      </h2>
      <div class="filters">
        <div class="search-box">
          <input type="text" id="search" class="search-input" placeholder="Search resources..." aria-label="Search resources">
          <i class="fas fa-search search-icon"></i>
        </div>
        <select id="year-filter" aria-label="Filter by year">
          <option value="all">All Year Levels</option>
          <option value="1st">1st Year</option>
          <option value="2nd">2nd Year</option>
          <option value="3rd">3rd Year</option>
          <option value="4th">4th Year</option>
        </select>
        <select id="subject-filter" aria-label="Filter by subject">
          <option value="all">All Subjects</option>
        </select>
      </div>
      <div class="carousel-container">
        <div class="book-carousel" id="book-carousel"></div>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-content">
      <img src="https://olivarezcollegetagaytay.edu.ph/img/olivarez-college-tagaytay-logo.png" style="width: 60px; border-radius: 8px;">
      <p>&copy; 2025 Olivarez College Tagaytay - Nursing Department</p>
    </div>
  </footer>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbxmNGir39fyhWefGxfMvqpsGejuLiqTlXdWs2rpGup87hS-1Om88NgSDtQTxDblV-Ju/exec';
    let allBooks = [];

    async function loadBooks() {
      try {
        const response = await fetch(API_URL);
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
        const data = await response.json();
        allBooks = data;
        renderBooks(allBooks);
        updateFilters();
      } catch (error) {
        console.error('Error loading books:', error);
        alert('Failed to load books. Please refresh the page.');
      }
    }

    function renderBooks(books) {
      const bookCarousel = document.getElementById('book-carousel');
      bookCarousel.innerHTML = '';
      
      books.forEach(book => {
        const bookItem = document.createElement('div');
        bookItem.classList.add('book-item');
        bookItem.dataset.year = book.year;
        bookItem.dataset.subject = book.subject.toLowerCase().replace(/ /g, '-');
        
        bookItem.innerHTML = `
          <img src="${book.image}" class="book-image" alt="${book.title}">
          <h3 class="book-title">${book.title}</h3>
          <div class="book-meta">
            <span>${book.year} Year</span>
            <span>${book.subject}</span>
          </div>
          <a href="${book.pdf}" target="_blank" class="view-pdf">View PDF</a>
        `;
        bookCarousel.appendChild(bookItem);
      });
    }

    document.getElementById('book-form').addEventListener('submit', async function(e) {
      e.preventDefault();
  
      const newBook = {
        title: document.getElementById('book-title').value.trim(),
        year: document.getElementById('book-year').value.trim(),
        subject: document.getElementById('book-subject').value.trim(),
        image: document.getElementById('book-image-url').value.trim(),
        pdf: document.getElementById('book-pdf-url').value.trim()
      };

      if (!newBook.title || !newBook.year || !newBook.subject || !newBook.image || !newBook.pdf) {
        alert('Please fill all fields');
        return;
      }

      try {
        await fetch(API_URL, { method: 'GET' });

        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(newBook)
        });

        if (!response.ok) throw new Error(`Server error: ${response.statusText}`);

        const result = await response.json();
        if (result.error) throw new Error(result.error);

        alert('Book added successfully!');
        await loadBooks();
        this.reset();
      } catch (error) {
        console.error('Upload failed:', error);
        alert(`Upload failed: ${error.message}`);
      }
    });

    document.getElementById('year-filter').addEventListener('change', updateFilters);
    document.getElementById('subject-filter').addEventListener('change', filterBooks);
    document.getElementById('search').addEventListener('input', filterBooks);

    document.addEventListener('DOMContentLoaded', loadBooks);
  </script>
</body>
</html>